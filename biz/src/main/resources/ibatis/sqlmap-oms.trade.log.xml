<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="oms.trade.log">
	
	<typeAlias alias="tradeLog" type="com.hsh24.sync.api.oms.bo.TradeLog" />
	
	<select id="getTradeLogList" parameterClass="tradeLog" resultClass="tradeLog">
	<![CDATA[
		SELECT ID,
			   TRADE_ID AS tradeId,
			   TYPE
		  FROM dms.dms_tb_trade_log
		 WHERE STATE= 'U'
		 AND t.times < 3
		 ORDER BY MODIFY_DATE
		 LIMIT 10
	]]>
	</select>

	<update id="finishTradeLog" parameterClass="tradeLog">
	<![CDATA[
		UPDATE dms.dms_tb_trade_log t
		   SET t.STATE = 'D',
			   t.MODIFY_DATE = NOW(),
			   t.MODIFY_USER = #modifyUser#
		 WHERE t.id = #id#
		   AND t.STATE = 'U'
	]]>
	</update>
	
	<update id="recordTradeLog" parameterClass="tradeLog">
	<![CDATA[
		UPDATE dms.dms_tb_trade_log t
		   SET t.times = t.times + 1,
			   t.error = CONCAT(t.error, #error#),
			   t.MODIFY_DATE = NOW(),
			   t.MODIFY_USER = #modifyUser#
		 WHERE t.id = #id#
		   AND t.STATE = 'U'
	]]>
	</update>
	
</sqlMap>
	